<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>"Data" Day Scores</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
body { font-family:'Roboto',sans-serif; background:#fff; margin:0; padding:10px; text-align:center; }
h1 { margin:10px 0; font-size:1.8rem; color:#333; }
button {
  padding: 10px 24px;
  font-size: 1rem;
  font-weight: 500;
  color: #fff;
  background: linear-gradient(to bottom, #007aff, #0051a8);
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  margin: 5px;
}
button:hover {
  background: linear-gradient(to bottom, #0051a8, #007aff);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  transform: translateY(-1px);
}

/* Modal */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color: rgba(0,0,0,0.6); overflow:auto; }
.modal-content { background:#fff; margin:2% auto; padding:10px; border-radius:8px; width:90%; max-width:900px; max-height:90%; overflow:auto; position:relative; }
.close-btn { position:absolute; top:10px; right:15px; font-size:1.5rem; font-weight:bold; color:#333; cursor:pointer; }

/* Table */
.sheet-container { width:100%; overflow-x:auto; padding:5px; }
table { border-collapse:collapse; width:max-content; min-width:100%; table-layout:fixed; font-size:1rem; background:#fff; }
td, th { text-align:center; word-break:break-word; padding:4px 6px; border:1px solid #ddd; }
tbody tr:nth-child(even) { background-color:#f9f9f9; }
thead { background:#f2f2f2; font-weight:bold; position:sticky; top:0; z-index:2; }

/* Dartboard canvas */
#dartboard { width:100%; height:auto; display:block; margin:0 auto; }
</style>
</head>
<body>
<h1>"Data" Day Scores</h1>
<button id="openModalBtn">Cheaccuracy</button>
<button id="openStandingsBtn">Standings</button>

<!-- Cheaccuracy Modal -->
<div id="dartModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="closeDart">&times;</span>
    <h2>Cheaccuracy</h2>
    <p>Accuracy of each game - Cheah's data vs. result</p>
    <canvas id="dartboard" width="700" height="700"></canvas>
    <div id="dartStats" style="margin-top:10px;font-weight:bold;"></div>
  </div>
</div>

<!-- Standings Modal -->
<div id="standingsModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" id="closeStandings">&times;</span>
    <h2 style="margin-bottom:10px;">Standings</h2>
    <div class="sheet-container">
      <table id="standings-table"><thead></thead><tbody></tbody></table>
    </div>
  </div>
</div>

<!-- Main table -->
<div class="sheet-container">
  <table id="sheet-table"><thead></thead><tbody></tbody></table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(async function(){
  // --- Main sheet table ---
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRzZ98moW_HArkbdGmyy83BjEVJn3pvpnOtOM66bs77BERNHalhZGkM8KodckPh8QybWJBnz3OwqZaa/pub?output=csv";
  const res = await fetch(url);
  const text = await res.text();
  const rows = text.trim().split("\n").map(r=>r.split(","));
  const tbody = document.querySelector("#sheet-table tbody");
  rows.forEach((row)=>{
    const tr = document.createElement("tr");
    row.forEach((cell,colIndex)=>{
      const td = document.createElement("td");
      td.textContent = cell;
      if(colIndex===1) td.style.fontWeight="normal";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  // --- Conditional formatting ---
  for(let i=4;i<tbody.rows.length;i+=4) tbody.rows[i].style.fontStyle="italic";
  const numbers = rows.flat().map(c=>parseFloat(c)).filter(v=>!isNaN(v));
  const minVal=Math.min(...numbers);
  const maxVal=Math.max(...numbers);
  function getColor(value){ const ratio=(value-minVal)/(maxVal-minVal); const r=Math.floor(255*ratio); const g=Math.floor(255*(1-ratio)); return `rgb(${r},${g},0)`; }
  for(let r=5;r<tbody.rows.length;r+=4){
    Array.from(tbody.rows[r].cells).forEach(td=>{
      const val=parseFloat(td.textContent);
      if(!isNaN(val)){ td.style.backgroundColor=getColor(val); td.style.color="#fff"; }
    });
  }
  for(let i=4;i<tbody.rows.length;i+=4){
    const cur=tbody.rows[i], prev=tbody.rows[i-1];
    if(!cur||!prev) continue;
    for(let c=2;c<Math.min(cur.cells.length,18);c++){
      const t1=cur.cells[c].textContent.trim().split(" ")[0];
      const t2=prev.cells[c].textContent.trim().split(" ")[0];
      if(t1&&t1===t2){ cur.cells[c].style.backgroundColor="lightgreen"; prev.cells[c].style.backgroundColor="lightgreen"; }
    }
  }

  // --- Dartboard modal ---
  const dartModal=document.getElementById("dartModal");
  const openBtn=document.getElementById("openModalBtn");
  const closeBtn=document.getElementById("closeDart");
  const statsDiv = document.getElementById("dartStats");
  let chartInitialized=false;
  openBtn.onclick=()=>{
    dartModal.style.display="block";
    if(!chartInitialized){ initDartboard(); chartInitialized=true; }
  };
  closeBtn.onclick=()=>{ dartModal.style.display="none"; };

  function initDartboard(){
    statsDiv.innerHTML = "Dartboard chart will appear here.";
  }

  // --- Standings modal ---
  const standingsModal = document.getElementById("standingsModal");
  document.getElementById("openStandingsBtn").onclick = async () => {
    standingsModal.style.display = "block";
    await loadStandings();
  };
  document.getElementById("closeStandings").onclick = () => standingsModal.style.display = "none";

  async function loadStandings(){
    const url2 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRzZ98moW_HArkbdGmyy83BjEVJn3pvpnOtOM66bs77BERNHalhZGkM8KodckPh8QybWJBnz3OwqZaa/pub?gid=812722975&single=true&output=csv";
    const res = await fetch(url2);
    const text = await res.text();
    const rows = text.trim().split("\n").map(r=>r.split(","));
    const table = document.getElementById("standings-table");
    const thead = table.querySelector("thead"); thead.innerHTML="";
    const tbody = table.querySelector("tbody"); tbody.innerHTML="";

    const headRow = document.createElement("tr");
    rows[0].forEach(cell => { const th=document.createElement("th"); th.textContent=cell; headRow.appendChild(th); });
    thead.appendChild(headRow);

    rows.slice(1).forEach(row => {
      const tr = document.createElement("tr");
      row.forEach(cell => { const td=document.createElement("td"); td.textContent=cell; tr.appendChild(td); });
      tbody.appendChild(tr);
    });
  }

  // Close modals on click outside
  window.onclick = (e) => {
    if(e.target===dartModal) dartModal.style.display="none";
    if(e.target===standingsModal) standingsModal.style.display="none";
  };
})();
</script>
</body>
</html>
